'=============================================================================
'  File:      PublishStandardReports.rss
'
'  Summary:  Demonstrates a script that can be used with RS.exe to 
'	     publish the sample reports that ship with Reporting Services.
'
'---------------------------------------------------------------------
'// ###########################################################################
'// #  Copyright (c) 2006. The Department of the MMSoftware 
'// #                           MMSOFTWARE. All Rights Reserved.
'// #  
'// #  Permission to use, copy, modify, and distribute this software and its
'// #  documentation for any purpose, without fee, and without a written
'// #  agreement, is here by granted, provided that the above copyright notice, 
'// #  this paragraph and the following two paragraphs appear in all copies, 
'// #  modifications, and distributions.  Created by: 
'// #
'// #                        M.M.S.O.F.T.W.A.R.E
'// #
'// #  Department of MMSoftware, MMSoftware, 35 Tan Vinh Street, 
'// #  District 4, Ho Chi Minh City, Viet Nam.
'// #  For technical information, contact mmsoftvn@gmail.com
'// #  
'// #  IN NO EVENT SHALL REGENTS BE LIABLE TO ANY PARTY FOR DIRECT, INDIRECT,
'// #  SPECIAL, INCIDENTAL, OR CONSEQUENTIAL DAMAGES, INCLUDING LOST PROFITS,
'// #  ARISING OUT OF THE USE OF THIS SOFTWARE AND ITS DOCUMENTATION, EVEN IF
'// #  REGENTS HAS BEEN ADVISED OF THE POSSIBILITY OF SUCH DAMAGE.
'// #  
'// #  REGENTS SPECIFICALLY DISCLAIMS ANY WARRANTIES, INCLUDING, BUT NOT
'// #  LIMITED TO, THE IMPLIED WARRANTIES OF MERCHANTABILITY AND FITNESS FOR A
'// #  PARTICULAR PURPOSE. THE SOFTWARE AND ACCOMPANYING DOCUMENTATION, IF
'// #  ANY, PROVIDED HEREUNDER IS PROVIDED "AS IS". REGENTS HAS NO OBLIGATION
'// #  TO PROVIDE MAINTENANCE, SUPPORT, UPDATES, ENHANCEMENTS, OR
'// #  MODIFICATIONS.
'// ###########################################################################
'=============================================================================


' 1.0 Documentation
'
' Read the following in order to familiarize yourself with the script.
' 
' 1.1 Overview
'
' This script  add new reports, add new data sources, logo(image file if any) to ReportServer  
' by insert outside values like serverName, username,password of the SQL database 2005, 
' the path of the Reports.
' 
' 1.2 Script Variables
'
' Variables that are passed on the command line with the -v switch:
'
' (a) serverName - the variable for configuring the Name of the SQL Server. Possible values are "get", 
'
' (b) username - the variable for configuring the user id to connect to the database. 
'
' (c) password  - the variable for configuring the pwd to connect to the database. 
' 
' (d) filePath  - the variable for configuring the path of the Report Files (.rdl). 
' 
' 1.3 Sample Command Lines
'
' 1.3.1 Upload the reports, datasource to server
'
'       rs -i PublishStandardReport.rss -s http://localhost/reportserver -v serverName="ServerName" -v username="sa" -v password="" -v filePath="C:/StandardReport/" 
'

'********************************************
'################################
'NOTE: 
'	1. filePath parameter use token: "/"
'	2. The end of filePath parameter must end with "/"	

'REPEAT EXAMPLE:
'             rs -i PublishStandardReport.rss -s http://localhost/reportserver -v serverName="ServerName" -v username="sa" -v password="" -v filePath="C:/StandardReport/"  

'###############################
'********************************************



Dim definition As [Byte]() = Nothing
Dim warnings As Warning() = Nothing

'*******************************************
	'Need to change here if not suitable
	'Change the parentFolder
'*******************************************
Dim parentFolder As String = "Standard Report"
Dim parentPath As String = "/" + parentFolder
'==========================================


Public Sub Main()

    rs.Credentials = System.Net.CredentialCache.DefaultCredentials
    
    'Create the parent folder
    Try
	
	rs.CreateFolder(parentFolder, "/", Nothing)
	Console.WriteLine("Parent folder {0} created successfully", parentFolder)

    Catch ee As SoapException
	'Console.WriteLine(ee.Message)
	Console.WriteLine("The item '/" & parentFolder & "' already exists.")				
    Catch e As Exception
        Console.WriteLine(e.Message)
    End Try


'******************************************************************
	'Need to change here if not suitable
	'Change the DataSource and ReportName
'******************************************************************
    'Create the MYVUE shared data source
    CreateSharedDataSource(serverName,username,password)	
    
    'Publish the reports
    PublishReport("AdviserFumReport")	
    PublishReport("AdviserInflowReport")
    PublishReport("AdviserNetflowReport")
    PublishReport("AdviserOutflowReport")	
    PublishReport("ClientMailMergeReport")
    PublishReport("FumReport")
    PublishReport("FundsFlowByAccount")
    PublishReport("FundsFlowByProduct")
    PublishReport("InvestmentOptionTransactionReport")
    PublishReport("InvestorSummary")
    
    	
  

'===============================================


End Sub

Public Sub CreateSharedDataSource(ByVal sqlServerName as String,ByVal username as String,ByVal password as String)
    Dim name As String = "IntelliVue"	
    'Define the data source definition.
    Dim definition As New DataSourceDefinition()
    definition.CredentialRetrieval = CredentialRetrievalEnum.Store

   '****************************************************************************	
    'You can change the database name by changing the initial catalog	
   '****************************************************************************
    definition.ConnectString = "data source=" & sqlServerName & ";initial catalog=DW;"
    definition.Enabled = True
    definition.EnabledSpecified = True
    definition.Extension = "SQL"
    definition.ImpersonateUser = False
    definition.ImpersonateUserSpecified = True
    definition.WindowsCredentials = False
    definition.UserName = username
    definition.Password = password
	
Try
    rs.CreateDataSource(name, parentPath, TRUE, definition, Nothing)
    Console.WriteLine("Data source {0} created successfully", name)

Catch e As Exception
    Console.WriteLine(e.Message)
End Try
    
End Sub 

Public Sub PublishReport(ByVal reportName As String)
    Try
        Dim stream As FileStream = File.OpenRead(filePath + reportName + ".rdl")
        definition = New [Byte](stream.Length) {}
        stream.Read(definition, 0, CInt(stream.Length))
        stream.Close()

    Catch e As IOException
        Console.WriteLine(e.Message)
    End Try

    Try
        warnings = rs.CreateReport(reportName, parentPath, TRUE, definition, Nothing)

        If Not (warnings Is Nothing) Then
            Dim warning As Warning
            For Each warning In warnings
                Console.WriteLine(warning.Message)
            Next warning

        Else
            Console.WriteLine("Report: {0} published successfully with no warnings", reportName)
        End If

    Catch e As Exception
        Console.WriteLine(e.Message)
    End Try
End Sub 

Public Sub PublishImage(ByVal imageName As String) 
Try 
Dim stream As FileStream = File.OpenRead(filePath + imageName) 
definition = New [Byte](stream.Length) {} 
stream.Read(definition, 0, CInt(stream.Length)) 
stream.Close() 

Catch e As IOException 
Console.WriteLine(e.Message) 
End Try 

Try 
rs.CreateResource(imageName, parentPath, TRUE, definition, "image/jpeg", Nothing) 

Console.WriteLine("Image: {0} published successfully", imageName) 

Catch e As Exception 
Console.WriteLine(e.Message) 
End Try 
End Sub 
